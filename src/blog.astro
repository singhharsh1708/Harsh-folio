---
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import Hr from "@/components/Hr.astro";
import { getCollection } from "astro:content";
import { getPath } from "@/utils/getPath";
import { formatDate } from "@/utils/formatDate";

const posts = await getCollection("blog", ({ data }) => !data.draft);
const sortedPosts = posts.sort(
  (a, b) => new Date(b.data.pubDate) - new Date(a.data.pubDate)
);
---

<Layout>
  <Header />

  <main id="main-content" class="px-6 py-12 max-w-4xl mx-auto">
    <!-- Breadcrumb -->
    <nav class="text-sm text-gray-500 dark:text-gray-400 mb-3">
      <a href="/" class="hover:underline">Home</a> &raquo; <span>Blog</span>
    </nav>

    <!-- Heading -->
    <h1 class="text-3xl font-bold tracking-tight text-accent mb-2">📝 Blog</h1>

    <!-- Description -->
    <p class="text-base text-gray-600 dark:text-gray-300 leading-relaxed mb-6">
      Posts about what I'm learning, building, and exploring as a developer.
    </p>

    <Hr />

    <!-- Blog Post List -->
    <section class="space-y-8 mt-8 mb-12">
      {sortedPosts.map(post => (
        <div class="border border-gray-300 dark:border-gray-700 p-6 rounded-xl shadow-md hover:shadow-lg transition">
          <h2 class="text-2xl font-semibold mb-1">
            <a href={`/blog/${getPath(post.id, post.slug, false)}`} class="text-accent hover:underline">
              {post.data.title}
            </a>
          </h2>
          <p class="text-sm text-gray-500 dark:text-gray-400 mb-2">{formatDate(post.data.pubDate)}</p>
          <p class="text-base text-gray-700 dark:text-gray-300 leading-relaxed">
            {post.data.description}
          </p>
        </div>
      ))}
    </section>
  </main>

  <Footer />
</Layout>
